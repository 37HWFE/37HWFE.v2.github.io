<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>不好意思，观察者模式跟发布订阅模式就是不一样 | Ocean Team Blog</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="Ocean Team Blog"><meta name="description" content="Ocean Team Blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://www.37oct.cn/2021/02/20/observer-and-publishers/index.html"><link rel="icon" type="image/png" href="/img/logo.png" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Ocean Team Blog" type="application/atom+xml"><link rel="stylesheet" href="/scss/views/page/post.css"><meta name="generator" content="Hexo 5.3.0"></head><body ontouchstart><div id="page-loading" class="page page-loading"><div class="wrap"><div class="k-line k-line11-1"></div><div class="k-line k-line11-2"></div><div class="k-line k-line11-3"></div><div class="k-line k-line11-4"></div><div class="k-line k-line11-5"></div></div></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Ocean Team Blog" alt="Ocean Team Blog"><img src="/img/logo.png" alt="Ocean Team Blog"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/images/2021/observer-and-publishers/cover.png" alt="不好意思，观察者模式跟发布订阅模式就是不一样"></div><header class="post__info"><h1 class="post__title">不好意思，观察者模式跟发布订阅模式就是不一样</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a target="_blank" rel="noopener" href="https://37hwfe.github.io/">oceanTeam</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2021-02-20</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/JavaScript/">JavaScript</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>一天，小猪佩奇去了一家西餐厅，点了一份西冷牛扒，还叫了圣女果。后来服务员上了一碟番茄，佩奇小姐：这是你的「圣女果」。佩奇猪一眼就看出了猫腻：这tm是番茄，不是圣女果啊！于是就跟服务员理论起来：这是番茄不是圣女果，不是！服务员一脸懵逼：番茄不就是圣女果吗？…佩奇猪一脸「黑人问号」了：番茄是菜，圣女果是水果，这能一样？？？</p><hr><p>观察者模式与发布/订阅模式大概就跟番茄与圣女果的关系一样，剪不断理还乱。也许，我们也听过两种模式之间的一些区别，但我相信，大部分的人对其中差异的感知还是很弱的。在JavaScript里，Observer模式通常被我们用Publish/Subscribe模式来实现，不可否认这些模式很相似，但它们还是有很本质的区别！</p><h3 id="二、观察者模式与发布-订阅模式的区别"><a href="#二、观察者模式与发布-订阅模式的区别" class="headerlink" title="二、观察者模式与发布/订阅模式的区别"></a>二、观察者模式与发布/订阅模式的区别</h3><p>通过一张图来宏观了解差异：<br><img src="/images/2021/observer-and-publishers/1.jpg"></p><h4 id="1、对观察者模式的理解"><a href="#1、对观察者模式的理解" class="headerlink" title="1、对观察者模式的理解"></a>1、对观察者模式的理解</h4><blockquote><p>观察者模式：一个对象（称为<font color="#42b983">subject</font>）维持一系列依赖于它的对象（称为<font color="#42b983">observer</font>），将有关状态的任何变更自动通知给它们（观察者）。</p></blockquote><h4 id="2、对发布-订阅模式的理解"><a href="#2、对发布-订阅模式的理解" class="headerlink" title="2、对发布/订阅模式的理解"></a>2、对发布/订阅模式的理解</h4><blockquote><p>发布/订阅模式：基于一个主题/事件通道，希望接收通知的对象（称为<font color="#42b983">subscriber</font>）通过自定义事件订阅主题，被激活事件的对象（称为<font color="#42b983">publisher</font>）通过发布主题事件的方式被通知。</p></blockquote><h4 id="3、两种模式之间的差异"><a href="#3、两种模式之间的差异" class="headerlink" title="3、两种模式之间的差异"></a>3、两种模式之间的差异</h4><ul><li>Observer模式要求观察者必须订阅内容改变的事件，定义了一个<font color="#42b983">一对多</font>的依赖关系；</li><li>Publish/Subscribe模式使用了一个<font color="#42b983">主题/事件通道</font>，这个通道介于订阅着与发布者之间；</li><li>观察者模式里面观察者「被迫」执行内容改变事件（subject内容事件）；发布/订阅模式中，订阅着可以自定义事件处理程序；</li><li>观察者模式两个对象之间有很强的依赖关系；发布/订阅模式两个对象之间的耦合读底。</li></ul><h3 id="三、举个栗子"><a href="#三、举个栗子" class="headerlink" title="三、举个栗子"></a>三、举个栗子</h3><p>使用两个栗子形象解释两种模式应用上的差异，让你由内而外，自上而下，感知它的美妙！@佩奇猪的故事</p><h5 id="1、观察者模式的应用"><a href="#1、观察者模式的应用" class="headerlink" title="1、观察者模式的应用"></a>1、观察者模式的应用</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为半伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义下观察者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.update = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定一个下目标</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subscribe</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加观察者</span></span><br><span class="line">Subscribe.prototype.addObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标通知变更</span></span><br><span class="line">Subscribe.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个佩奇猪的观察者</span></span><br><span class="line"><span class="keyword">var</span> peikizhuObs = <span class="keyword">new</span> Observer();</span><br><span class="line">peikizhuObs.update = <span class="function"><span class="keyword">function</span>(<span class="params">what</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;12 o&#x27;clock! 佩奇猪想要&quot;</span> + what);</span><br><span class="line">&#125;</span><br><span class="line">Subscribe.addObserver(peikizhuObs);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个皮卡丘的观察者</span></span><br><span class="line"><span class="keyword">var</span> pikachuObs = <span class="keyword">new</span> Observer();</span><br><span class="line">pikachuObs.update = <span class="function"><span class="keyword">function</span>(<span class="params">what</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;皮卡丘还可以做一点自己比较个性的事情，但是12点我也是要去吃饭的！&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;12 o&#x27;clock! 皮卡丘想要&quot;</span> + what);</span><br><span class="line">&#125;</span><br><span class="line">Subscribe.addObserver(pikachuObs);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假装12点到了</span></span><br><span class="line">Subscribe.notify(<span class="string">&#x27;去吃饭啦～&#x27;</span>);  <span class="comment">// 它们都去吃饭了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">Subscribe.notify(<span class="string">&#x27;继续玩耍～&#x27;</span>);  <span class="comment">// 它们还在一起玩耍</span></span><br></pre></td></tr></table></figure><p><font color="#f66"><strong>说明：</strong></font>可以看出，每一个observer虽然也可以自定义自己的处理程序（<font color="#e96900">update</font>方法），但是<font color="#42b983">观察者模式下，观察者们都是做同一类的事情的</font>。</p><h5 id="2、发布-订阅模式的应用"><a href="#2、发布-订阅模式的应用" class="headerlink" title="2、发布/订阅模式的应用"></a>2、发布/订阅模式的应用</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为半伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简易的发布订阅</span></span><br><span class="line"><span class="keyword">var</span> pubsub = &#123;</span><br><span class="line">    subscribe: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    publish: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 佩奇猪：我要订阅一个「12点」的主题事件，提醒我继续工作</span></span><br><span class="line">pubsub.subscribe(<span class="string">&quot;12 o&#x27;clock&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(who + <span class="string">&#x27;要继续工作！这就是为什么本猪上了屏幕，而你们上了餐桌。&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 皮卡丘：我也要订阅一个「12点」的主题事件，提醒我去吃饭</span></span><br><span class="line">pubsub.subscribe(<span class="string">&quot;12 o&#x27;clock&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(who + <span class="string">&#x27;要吃饭，去它的工作！&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假装12点到了</span></span><br><span class="line">pubsub.publish(<span class="string">&quot;12 o&#x27;clock&quot;</span>,<span class="string">&#x27;PeikiZhu&#x27;</span>);</span><br><span class="line">pubsub.publish(<span class="string">&quot;12 o&#x27;clock&quot;</span>,<span class="string">&#x27;PiKaChu&#x27;</span>);</span><br></pre></td></tr></table></figure><p><font color="#f66"><strong>说明：</strong></font>如你所见，发布/订阅模式，订阅的是订阅者各自不同逻辑的处理程序，类比下jQuery订阅点击事件。</p><h3 id="四、从实现方式上理解差异"><a href="#四、从实现方式上理解差异" class="headerlink" title="四、从实现方式上理解差异"></a>四、从实现方式上理解差异</h3><p>那么，到了这里，有没有比较有feel了？有没有get到那个…只可意会不可言传的点？</p><p>还是没有？？？</p><p>原谅在下不善言辞，只想丢段代码给你。从实现方式上看两者的不同</p><h5 id="1、实现观察者模式"><a href="#1、实现观察者模式" class="headerlink" title="1、实现观察者模式"></a>1、实现观察者模式</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者模式组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author  <span class="variable">wilton</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="built_in">module</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">ObserverList</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.observerLists = [];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加观察者对象</span></span><br><span class="line">	ObserverList.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 保证observer的唯一性</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.observerLists.indexOf(obj) != -<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">this</span>.observerLists;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.observerLists.push(obj);</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 清空观察者对象</span></span><br><span class="line">	ObserverList.prototype.empty = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.observerLists = [];</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算当前的观察者数量</span></span><br><span class="line">	ObserverList.prototype.count = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.observerLists.length;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 取出对应编号的观察者对象</span></span><br><span class="line">	ObserverList.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (index &gt; -<span class="number">1</span> &amp;&amp; index &lt; <span class="built_in">this</span>.observerLists.length) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.observerLists[index];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 指定位置上插入观察者对象</span></span><br><span class="line">	ObserverList.prototype.insert = <span class="function"><span class="keyword">function</span>(<span class="params">obj,index</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> pointer = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">this</span>.observerLists.unshift(obj);</span><br><span class="line">			pointer = index;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="built_in">this</span>.observerLists.length) &#123;</span><br><span class="line">			<span class="built_in">this</span>.observerLists.push(obj);</span><br><span class="line">			pointer = index;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.observerLists.splice(index, <span class="number">0</span>, obj);</span><br><span class="line">			pointer = index;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> pointer;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查找观察者对象所在的位置编号</span></span><br><span class="line">	ObserverList.prototype.indexOf = <span class="function"><span class="keyword">function</span>(<span class="params">obj, startIndex</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> i = startIndex || <span class="number">0</span>, pointer = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (i &lt; <span class="built_in">this</span>.observerLists.length) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.observerLists[i] === obj) &#123;</span><br><span class="line">				pointer = i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> pointer;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 移除指定编号的观察者</span></span><br><span class="line">	ObserverList.prototype.removeIndexAt = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> temp = <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">			temp = <span class="built_in">this</span>.observerLists.shift();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="built_in">this</span>.observerLists.length) &#123;</span><br><span class="line">			temp = <span class="built_in">this</span>.observerLists.pop();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			temp = <span class="built_in">this</span>.observerLists.splice(index, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义目标类</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">Subject</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.observers = <span class="keyword">new</span> ObserverList();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加观察者</span></span><br><span class="line">	Subject.prototype.addObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.observers.add(observer);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 移除观察者</span></span><br><span class="line">	Subject.prototype.removeObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.observers.removeIndexAt(<span class="built_in">this</span>.observers.indexOf(observer, <span class="number">0</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通知观察者</span></span><br><span class="line">	Subject.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> observersCount = <span class="built_in">this</span>.observers.count();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; observersCount; i++)&#123;</span><br><span class="line">			<span class="built_in">this</span>.observers.get(i).update(params);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 定义观察者内容更新事件</span></span><br><span class="line">		<span class="built_in">this</span>.update = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">module</span>.exports = &#123;</span><br><span class="line">		Observer: Observer,</span><br><span class="line">		Subject: Subject,</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 对象扩展</span></span><br><span class="line">		extend: <span class="function"><span class="keyword">function</span>(<span class="params">obj, extension</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">				extension[key] = obj[key];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://github.com/qiudongwei/pattern-struct/tree/master/ObserverPattern">github-ObserverPattern</a></p><h5 id="2、实现发布-订阅模式"><a href="#2、实现发布-订阅模式" class="headerlink" title="2、实现发布/订阅模式"></a>2、实现发布/订阅模式</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发布/订阅模式组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author  <span class="variable">wilton</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义发布/订阅类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pubsub</span> </span>&#123;</span><br><span class="line">	<span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">		<span class="built_in">this</span>.topics = &#123;&#125;;</span><br><span class="line">		<span class="built_in">this</span>.subUid = -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发布事件</span></span><br><span class="line">	publish (topic, args) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">this</span>.topics[topic]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">let</span> subscribers = <span class="built_in">this</span>.topics[topic];</span><br><span class="line">		<span class="keyword">let</span> len = subscribers ? subscribers.length : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (len--) &#123;</span><br><span class="line">			subscribers[len].func(topic, args);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 订阅事件</span></span><br><span class="line">	subscribe (topic,func) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">this</span>.topics[topic]) <span class="built_in">this</span>.topics[topic] = [];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">let</span> token = (++<span class="built_in">this</span>.subUid).toString();</span><br><span class="line">		<span class="built_in">this</span>.topics[topic].push(&#123;</span><br><span class="line">			token: token,</span><br><span class="line">			func: func</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> token;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 取消订阅</span></span><br><span class="line">	unsubscribe (token) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> m <span class="keyword">in</span> topics) &#123;</span><br><span class="line">			<span class="keyword">if</span> (topics[m]) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; topics[m].length; i++) &#123;</span><br><span class="line">					<span class="keyword">if</span> (topics[m][i].token == token) &#123;</span><br><span class="line">						topics[m].splice(i, <span class="number">1</span>);</span><br><span class="line">						<span class="keyword">return</span> token;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Pubsub;</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://github.com/qiudongwei/pattern-struct/tree/master/PubsubPattern">github-PubsubPattern</a></p><h3 id="五、结语"><a href="#五、结语" class="headerlink" title="五、结语"></a>五、结语</h3><p>以上观点只是个人结合实践产出的理解，欢迎各位过路的大佬补充斧正～</p><div class="post-announce">感谢您的阅读，本文由 <a href="https://www.37oct.cn">Ocean Team Blog</a> 版权所有。如若转载，请注明出处：Ocean Team Blog（<a href="/2021/02/20/observer-and-publishers/">https://www.37oct.cn/2021/02/20/observer-and-publishers/</a>）</div><div class="post__prevs"><div class="post__prev"></div><div class="post__prev post__prev--right"><a href="/2021/02/20/what-is-react/" title="当我们谈论React时，我们谈论些什么？">当我们谈论React时，我们谈论些什么？<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">Ocean Team Blog</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%B7%A5%E5%85%B7/">资源工具</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/">前端知识</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/JavaScript/">JavaScript</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/CSS3/">CSS3</a><span class="block-list-count">1</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2021/02/20/http-memory-cache/" title="http 文件缓存机制"><div class="item__cover"><img src="/images/2021/http-memory-cache/cover.png" alt="http 文件缓存机制"></div><div class="item__info"><h3 class="item__title">http 文件缓存机制</h3><span class="item__text">2021-02-20</span></div></a></li><li class="latest-post-item"><a href="/2021/02/20/body-background-color-setting/" title="HTML/BODY背景渲染原理"><div class="item__cover"><img src="/images/2021/body-background-color-setting/cover.png" alt="HTML/BODY背景渲染原理"></div><div class="item__info"><h3 class="item__title">HTML/BODY背景渲染原理</h3><span class="item__text">2021-02-20</span></div></a></li><li class="latest-post-item"><a href="/2021/02/20/auto-ps-cut-image-function/" title="解放双手-ps自动切图脚本"><div class="item__cover"><img src="/images/2021/auto-ps-cut-image-function/cover.png" alt="解放双手-ps自动切图脚本"></div><div class="item__info"><h3 class="item__title">解放双手-ps自动切图脚本</h3><span class="item__text">2021-02-20</span></div></a></li><li class="latest-post-item"><a href="/2021/02/20/what-is-react/" title="当我们谈论React时，我们谈论些什么？"><div class="item__cover"><img src="/images/2021/what-is-react/cover.png" alt="当我们谈论React时，我们谈论些什么？"></div><div class="item__info"><h3 class="item__title">当我们谈论React时，我们谈论些什么？</h3><span class="item__text">2021-02-20</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Background/">Background</a></li><li class="tag-item"><a class="tag-link" href="/tags/CSS/">CSS</a></li><li class="tag-item"><a class="tag-link" href="/tags/HTML/">HTML</a></li><li class="tag-item"><a class="tag-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-item"><a class="tag-link" href="/tags/React/">React</a></li><li class="tag-item"><a class="tag-link" href="/tags/ps%E8%87%AA%E5%8A%A8%E5%88%87%E5%9B%BE/">ps自动切图</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD/">前端性能</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%B5%84%E6%BA%90%E5%B7%A5%E5%85%B7/">资源工具</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">主要用于分享37海外前端Ocean团队日常学习、交流、输出</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Guangzhou, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>zhouguilin@gm99.com</span></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["JavaScript"],gitalk=new Gitalk({clientID:"b397f402965c6c098926",clientSecret:"58b05fc4d0be418434fb2cb3aa942d9eb2e0c912",repo:"37hwfe.github.io",owner:"37HWFE",admin:["37HWFE"],labels:tags,id:new Date(1613802576e3).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href,proxy:"https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token"});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/common/utils.js"></script><script src="/js/common/pack.js"></script><script src="/js/common/animation.js"></script><script src="/js/layout/loading.js"></script><script src="/js/layout/header.js"></script><script src="/js/layout/back-top.js"></script><script src="/js/layout/post.js"></script></body></html>